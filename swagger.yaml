openapi: 3.0.3
info:
  title: Juta Berlian API
  version: 1.0.0
  description: API documentation for Jutaberlian system.

servers:
  - url: http://localhost:8000/api/v1
    description: Local development server
  - url: http://jutaberlian.id:8001/api/v1
    description: Staging server
  - url: https://jutaberlian.id/api/v1
    description: Production server

paths:
  /auth/login:
    post:
      summary: User login
      description: Authenticate a user and return a JWT token for subsequent authorized requests.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Successful authentication response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        "400":
          $ref: "#/components/responses/ValidationErrorResponse"
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

  /inventory/shared-items:
    get:
      summary: Get all shared items
      description: Retrieve a list of all shared items in inventory.
      tags:
        - Inventory - Shared Items
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination (starts from 1)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            default: 10
          description: Number of records per page
      responses:
        "200":
          description: Successful response with list of shared items
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/SharedItem"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

    post:
      summary: Create a new shared item
      description: Add a new shared item to the inventory.
      tags:
        - Inventory - Shared Items
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/postSharedItemSchema"
      responses:
        "201":
          description: Shared item created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 3
        "400":
          $ref: "#/components/responses/InvariantErrorResponse"
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

  /inventory/shared-items/{id}:
    get:
      summary: Get a shared item by ID
      description: Retrieve details of a specific shared item by its ID, including its borrow list.
      tags:
        - Inventory - Shared Items
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the shared item to retrieve
      responses:
        "200":
          description: Successful response with shared item details
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: "#/components/schemas/SharedItem"
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

    put:
      summary: Update an existing shared item
      description: Update name and description of an existing shared item by ID.
      tags:
        - Inventory - Shared Items
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the shared item to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/updateSharedItemSchema"
      responses:
        "200":
          description: Shared item updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Shared item updated successfully
        "400":
          $ref: "#/components/responses/ValidationErrorResponse"
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

    delete:
      summary: Delete a shared item
      description: Remove a shared item from the inventory by ID.
      tags:
        - Inventory - Shared Items
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the shared item to delete
      responses:
        "200":
          description: Shared item deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Shared item deleted successfully
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

  /inventory/borrow-lists:
    get:
      summary: Get all borrow lists
      description: Retrieve a list of all borrow lists from inventory.
      tags:
        - Inventory - Borrow Lists
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination (starts from 1)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            default: 10
          description: Number of records per page
        - in: query
          name: q
          schema:
            type: string
            default: ""
          description: query
        - in: query
          name: returned
          schema:
            type: boolean
            default: false
          description: Status
      responses:
        "200":
          description: Successful response with list of borrow lists
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/BorrowList"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

    post:
      summary: Create a new borrow list
      description: Add a new borrow record for a shared item.
      tags:
        - Inventory - Borrow Lists
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/postBorrowListSchema"
      responses:
        "201":
          description: Borrow list created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 10
        "400":
          $ref: "#/components/responses/ValidationErrorResponse"
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

  /inventory/borrow-lists/me:
    get:
      summary: Get all user's borrow lists
      description: Retrieve a list of all user's borrow lists from inventory.
      tags:
        - Inventory - Borrow Lists
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination (starts from 1)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            default: 10
          description: Number of records per page
        - in: query
          name: q
          schema:
            type: string
            default: ""
          description: query
      responses:
        "200":
          description: Successful response with list of borrow lists
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/BorrowList"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

  /inventory/borrow-lists/{id}:
    put:
      summary: Update borrow list return photo
      description: Upload or update the return photo for a borrow list record by ID.
      tags:
        - Inventory - Borrow Lists
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the borrow list to update
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - photo
              properties:
                photo:
                  type: string
                  format: binary
                  description: Return photo file to upload
      responses:
        "201":
          description: Return photo uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 10
        "400":
          $ref: "#/components/responses/ValidationErrorResponse"
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

    delete:
      summary: Delete a borrow list
      description: Delete a borrow list record by ID.
      tags:
        - Inventory - Borrow Lists
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the borrow list to delete
      responses:
        "200":
          description: Borrow list deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Borrow list deleted successfully
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

  /reservations/tables:
    get:
      summary: Get all reservation tables
      description: Retrieve a list of all reservation tables.
      tags:
        - Reservations - Tables
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination (starts from 1)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            default: 10
          description: Number of records per page
        - in: query
          name: q
          schema:
            type: string
            default: ""
          description: query
        - in: query
          name: is_active
          schema:
            type: string
            enum: ["true", "false"]
            default: "true"
          description: status
      responses:
        "200":
          description: Successful response with list of reservation tables
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      records:
                        type: array
                        items:
                          $ref: "#/components/schemas/ReservationTable"
                      metadata:
                        type: object
                        properties:
                          total_records:
                            type: integer
                            example: 5
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

    post:
      summary: Create a new reservation table
      description: Add a new reservation table configuration.
      tags:
        - Reservations - Tables
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PostReservationTableRequest"
      responses:
        "201":
          description: Reservation table created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
        "400":
          $ref: "#/components/responses/ValidationErrorResponse"
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

  /reservations/tables/{id}:
    get:
      summary: Get reservation table by ID
      description: Retrieve details of a specific reservation table by its ID.
      tags:
        - Reservations - Tables
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the reservation table to retrieve
      responses:
        "200":
          description: Successful response with reservation table detail
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      table:
                        $ref: "#/components/schemas/ReservationTable"
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

    put:
      summary: Update a reservation table
      description: Update the seat count of an existing reservation table by ID.
      tags:
        - Reservations - Tables
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the reservation table to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PostReservationTableRequest"
      responses:
        "200":
          description: Reservation table updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Table updated successfully
        "400":
          $ref: "#/components/responses/ValidationErrorResponse"
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

    delete:
      summary: Delete a reservation table
      description: Delete a reservation table by ID.
      tags:
        - Reservations - Tables
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the reservation table to delete
      responses:
        "200":
          description: Reservation table deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Table deleted successfully
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

  /reservations:
    get:
      summary: Get all reservations
      description: Retrieve a paginated list of reservations with optional status and search filter.
      tags:
        - Reservations
      parameters:
        - in: query
          name: page
          required: true
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination (starts from 1)
        - in: query
          name: limit
          required: true
          schema:
            type: integer
            minimum: 1
            default: 10
          description: Number of records per page
        - in: query
          name: q
          schema:
            type: string
            default: ""
          description: Search query (e.g. customer name or phone number)
        - in: query
          name: status
          required: true
          schema:
            type: string
            enum: [PENDING, CONFIRMED, SEATED, COMPLETED, CANCELLED, NO_SHOW]
            default: "CONFIRMED"
          description: Filter reservations by status
        - in: query
          name: start_date
          required: true
          schema:
            type: string
            format: datetime
            example: "2023-12-03 00:00:00"
        - in: query
          name: end_date
          required: true
          schema:
            type: string
            format: datetime
            example: "2023-12-03 23:59:59"
      responses:
        "200":
          description: Successful response with list of reservations
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      records:
                        type: array
                        items:
                          type: object
                          description: Reservation record
                          properties:
                            id:
                              type: integer
                              example: 1
                            customer_id:
                              type: integer
                              example: 10
                            guest_count:
                              type: integer
                              example: 4
                            status:
                              type: string
                              enum:
                                [
                                  PENDING,
                                  CONFIRMED,
                                  SEATED,
                                  COMPLETED,
                                  CANCELLED,
                                  NO_SHOW,
                                ]
                              example: CONFIRMED
                            special_occasion:
                              type: string
                              nullable: true
                              example: BIRTHDAY
                            notes:
                              type: string
                              nullable: true
                              example: "Window seat request"
                            start_datetime:
                              type: string
                              format: date-time
                              example: "2025-12-10T18:00:00+08:00"
                            end_datetime:
                              type: string
                              format: date-time
                              example: "2025-12-10T20:00:00+08:00"
                            created_at:
                              type: string
                              format: date-time
                            updated_at:
                              type: string
                              format: date-time
                      metadata:
                        type: object
                        properties:
                          total_records:
                            type: integer
                            example: 42
                          page:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 10
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

  /reservations/{id}:
    get:
      summary: Get reservation by ID
      description: Retrieve details of a specific reservation by its ID.
      tags:
        - Reservations
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the reservation to retrieve
      responses:
        "200":
          description: Successful response with reservation detail
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      reservation:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 1
                          customer_id:
                            type: integer
                            example: 10
                          guest_count:
                            type: integer
                            example: 4
                          status:
                            type: string
                            enum:
                              [
                                PENDING,
                                CONFIRMED,
                                SEATED,
                                COMPLETED,
                                CANCELLED,
                                NO_SHOW,
                              ]
                            example: CONFIRMED
                          special_occasion:
                            type: string
                            nullable: true
                            example: ANNIVERSARY
                          notes:
                            type: string
                            nullable: true
                            example: "Allergic to shellfish"
                          start_datetime:
                            type: string
                            format: date-time
                            example: "2025-12-10T18:00:00+08:00"
                          end_datetime:
                            type: string
                            format: date-time
                            example: "2025-12-10T20:00:00+08:00"
                          created_at:
                            type: string
                            format: date-time
                          updated_at:
                            type: string
                            format: date-time
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

    put:
      summary: Update reservation status
      description: Update the status of an existing reservation by ID.
      tags:
        - Reservations
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: ID of the reservation to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum:
                    [PENDING, CONFIRMED, SEATED, COMPLETED, CANCELLED, NO_SHOW]
                  example: CONFIRMED
      responses:
        "200":
          description: Reservation updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Reservation updated successfully
        "400":
          $ref: "#/components/responses/ValidationErrorResponse"
        "401":
          $ref: "#/components/responses/AuthenticationErrorResponse"
        "404":
          $ref: "#/components/responses/NotFoundErrorResponse"
        "500":
          $ref: "#/components/responses/ServerErrorResponse"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          example: admin
        password:
          type: string
          example: password123

    SharedItem:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Printer A3"
        description:
          type: string
          example: "High-resolution color printer"

    postSharedItemSchema:
      type: object
      required:
        - name
        - description
      properties:
        name:
          type: string
          example: "Projector"
        description:
          type: string
          example: "HD projector with HDMI support"

    updateSharedItemSchema:
      type: object
      required:
        - name
        - description
      properties:
        name:
          type: string
          example: "Updated Projector"
        description:
          type: string
          example: "Updated description for projector"

    BorrowList:
      type: object
      properties:
        id:
          type: integer
          example: 1
        shared_item_id:
          type: integer
          example: 3
        name:
          type: string
          example: "John Doe"
        borrow_start_date:
          type: string
          format: date
          example: "2025-11-01"
        borrow_end_date:
          type: string
          format: date
          example: "2025-11-05"
        item:
          $ref: "#/components/schemas/SharedItem"

    postBorrowListSchema:
      type: object
      required:
        - shared_item_id
        - name
        - borrow_start_date
        - borrow_end_date
      properties:
        shared_item_id:
          type: integer
          example: 3
        name:
          type: string
          example: "Jane Doe"
        borrow_start_date:
          type: string
          format: date
          example: "2025-11-01"
        borrow_end_date:
          type: string
          format: date
          example: "2025-11-03"

    ReservationTable:
      type: object
      properties:
        id:
          type: integer
          example: 1
        seats:
          type: integer
          example: 4
        table_number:
          type: integer
          example: 12

    PostReservationTableRequest:
      type: object
      required:
        - seats
        - table_number
      properties:
        seats:
          type: integer
          example: 4
        table_number:
          type: integer
          example: 4

  responses:
    InvariantErrorResponse:
      description: Validation failed due to invalid input
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                example: fail
              data:
                type: object
                additionalProperties:
                  type: array
                  items:
                    type: string
            example:
              status: fail
              data:
                name:
                  - "Field must not be empty"

    ValidationErrorResponse:
      description: Validation error response
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                example: fail
              data:
                type: object
                additionalProperties:
                  type: string
            example:
              status: fail
              data:
                shared_item_id: "This field is required"

    NotFoundErrorResponse:
      description: Not found error response
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                example: fail
              message:
                type: string
                example: "Data not found"

    ServerErrorResponse:
      description: Server error response
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                example: fail
              error:
                type: string
                example: "Internal server error"

    AuthenticationErrorResponse:
      description: Authentication error response
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
              message:
                type: string
            example:
              status: fail
              message: "Authentication failed"
